name: æ¯æ—¥ã®è¨˜äº‹è‡ªå‹•ç”Ÿæˆ

on:
  schedule:
    # æ¯æ—¥æ—¥æœ¬æ™‚é–“ã®æœ7æ™‚ï¼ˆUTC 22:00ï¼‰ã«å®Ÿè¡Œ
    - cron: '0 22 * * *'
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

permissions:
  contents: write

jobs:
  generate-article:
    runs-on: ubuntu-latest
    
    steps:
      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Pythonã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Pythonä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          pip install openai requests

      - name: è¨˜äº‹ã‚’ç”Ÿæˆ
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          UNSPLASH_ACCESS_KEY: ${{ secrets.UNSPLASH_ACCESS_KEY }}
        run: |
          echo "=== è¨˜äº‹ç”Ÿæˆé–‹å§‹ ==="
          python scripts/generate_article.py
          echo "=== è¨˜äº‹ç”Ÿæˆå®Œäº† ==="

      - name: å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add -A
          
          # å¤‰æ›´ãŒã‚ã‚‹å ´åˆã®ã¿ã‚³ãƒŸãƒƒãƒˆ
          if git diff --staged --quiet; then
            echo "å¤‰æ›´ãªã— - ã‚¹ã‚­ãƒƒãƒ—"
          else
            git commit -m "ğŸ“ $(date +'%Y-%m-%d') ã®è¨˜äº‹ã‚’è¿½åŠ "
            git push origin main
            echo "âœ… ãƒ—ãƒƒã‚·ãƒ¥å®Œäº† - NetlifyãŒè‡ªå‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™"
          fi
